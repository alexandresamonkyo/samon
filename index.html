<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contador Ininterrupto</title>

<style>
body {
    margin: 0;
    padding: 20px;
    font-family: Arial, Helvetica, sans-serif;
    background-color: #f4f4f4;
}
.container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
    max-width: 1200px;
    margin: auto;
}
.botao {
    background-color: #ffffff;
    color: #000;
    aspect-ratio: 2 / 1;
    border-radius: 8px;
    border: 3px solid #ccc;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 80px;
    font-weight: bold;
    transition: background-color 0.3s, color 0.3s;
}
.botao.ativo {
    background-color: #4CAF50;
    color: #fff;
}
.botao.alerta {
    background-color: #e53935;
    color: #fff;
    animation: piscar 1s infinite;
}
.tempo {
    font-size: 16px;
    margin-top: 5px;
    font-weight: normal;
}
@keyframes piscar {
    0% { opacity: 1; }
    50% { opacity: 0.3; }
    100% { opacity: 1; }
}
</style>
</head>
<body>

<div class="container" id="container"></div>

<script>
const container = document.getElementById("container");
const LIMITE_TEMPO = 1200; // segundos para teste

// Função para emitir bip
function tocarBip() {
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    oscillator.type = "sine";
    oscillator.frequency.value = 1000;
    gainNode.gain.value = 0.1;
    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    oscillator.start();
    oscillator.stop(audioCtx.currentTime + 0.2);
}

for (let i = 1; i <= 24; i++) {
    const button = document.createElement("button");
    button.className = "botao";
    button.innerHTML = `
        <div>${i}</div>
        <div class="tempo">00:00</div>
    `;
    container.appendChild(button);

    let bipInterval = null;

    // Recupera timestamp inicial do localStorage
    let inicio = localStorage.getItem(`botao_${i}_inicio`);
    if (inicio) inicio = parseInt(inicio);

    function atualizarTempo() {
        if (!inicio) {
            requestAnimationFrame(atualizarTempo);
            return;
        }

        let segundos = Math.floor((Date.now() - inicio) / 1000);

        if (segundos >= LIMITE_TEMPO) {
            // Inicia alerta e bip apenas uma vez
            if (!button.classList.contains("alerta")) {
                button.classList.remove("ativo");
                button.classList.add("alerta");
                tocarBip();
                bipInterval = setInterval(tocarBip, 2000);
            }
        } else {
            button.classList.add("ativo");
            button.classList.remove("alerta");
            if (bipInterval) {
                clearInterval(bipInterval);
                bipInterval = null;
            }
        }

        const min = String(Math.floor(segundos / 60)).padStart(2, "0");
        const sec = String(segundos % 60).padStart(2, "0");
        button.querySelector(".tempo").textContent = `${min}:${sec}`;

        requestAnimationFrame(atualizarTempo);
    }
    atualizarTempo();

    button.addEventListener("click", () => {
        if (inicio) {
            const confirmar = confirm("Deseja zerar o tempo deste botão?");
            if (confirmar) {
                inicio = null;
                localStorage.removeItem(`botao_${i}_inicio`);
                button.classList.remove("ativo", "alerta");
                button.querySelector(".tempo").textContent = "00:00";
                if (bipInterval) clearInterval(bipInterval);
                bipInterval = null;
            }
            return;
        }

        inicio = Date.now();
        localStorage.setItem(`botao_${i}_inicio`, inicio);
        button.classList.add("ativo");
    });
}
</script>

</body>
</html>
